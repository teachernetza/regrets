<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wishes & Regrets | Rators Club</title>
    
    <link rel="icon" type="image/png" href="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w128">
    <link rel="apple-touch-icon" href="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w512">
    <meta name="theme-color" content="#1A2B4C">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Lora:ital,wght@0,400;0,600;1,400;1,600&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* ==========================================================================
           1. RATORS CLUB BRANDING (NAVY & WHITE)
           ========================================================================== */
        :root {
            --rc-navy: #1A2B4C;       /* Azul Marino Institucional */
            --rc-navy-light: #2A406D; 
            --rc-white: #FFFFFF;      
            --rc-bg: #F5F7FA;         /* Gris muy claro */
            --rc-gray: #E2E8F0;       
            
            --text-main: #0F172A;
            --text-muted: #64748B;
            
            --success: #10B981;
            --error: #EF4444;
            --warning: #F59E0B;
            
            --sidebar-width: 280px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --shadow-sm: 0 4px 6px -1px rgba(26, 43, 76, 0.08);
            --shadow-lg: 0 15px 35px -5px rgba(26, 43, 76, 0.15);
            --trans: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: 'Poppins', sans-serif; background-color: var(--rc-bg);
            color: var(--text-main); line-height: 1.6; overflow-x: hidden; display: flex;
        }

        h1, h2, h3 { font-family: 'Lora', serif; color: var(--rc-navy); }
        p { margin-bottom: 1rem; }
        strong { font-weight: 700; color: var(--rc-navy); }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--rc-bg); }
        ::-webkit-scrollbar-thumb { background: var(--rc-navy-light); border-radius: 4px; }

        /* ==========================================================================
           2. PANTALLA DE BIENVENIDA (GATEWAY)
           ========================================================================== */
        #welcome-gateway {
            position: fixed; inset: 0; background: var(--rc-white); z-index: 9999;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 2rem; text-align: center;
        }
        
        .gateway-logo {
            width: 130px; height: 130px; border-radius: 50%; border: 5px solid var(--rc-navy);
            margin-bottom: 2rem; overflow: hidden; box-shadow: var(--shadow-lg);
        }
        .gateway-logo img { width: 100%; height: 100%; object-fit: cover; }
        
        .gateway-title { font-family: 'Lora'; font-size: 2.2rem; color: var(--rc-navy); margin-bottom: 0.5rem; }
        .gateway-sub { color: var(--text-muted); font-weight: 500; margin-bottom: 2.5rem; text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem; }
        
        .name-input {
            width: 100%; max-width: 350px; padding: 18px 20px; border-radius: var(--radius-md);
            border: 2px solid var(--rc-gray); background: var(--rc-bg); text-align: center;
            font-family: 'Poppins'; font-size: 1.1rem; font-weight: 700; color: var(--rc-navy);
            transition: var(--trans); margin-bottom: 20px; outline: none;
        }
        .name-input:focus { border-color: var(--rc-navy); background: var(--rc-white); box-shadow: 0 0 0 4px rgba(26, 43, 76, 0.1); }
        
        .btn-gateway {
            background: var(--rc-navy); color: var(--rc-white); padding: 18px 40px; border-radius: 50px;
            border: none; font-size: 1.1rem; font-weight: 800; cursor: pointer; letter-spacing: 1px;
            box-shadow: 0 10px 20px rgba(26, 43, 76, 0.2); transition: 0.2s; width: 100%; max-width: 350px;
        }
        .btn-gateway:hover { transform: translateY(-2px); box-shadow: 0 15px 25px rgba(26, 43, 76, 0.3); }
        .btn-gateway:active { transform: translateY(0); }

        /* ==========================================================================
           3. SIDEBAR (NAVEGACIÓN LATERAL)
           ========================================================================== */
        .sidebar {
            width: var(--sidebar-width); height: 100vh; background: var(--rc-navy);
            color: var(--rc-white); position: fixed; top: 0; left: 0; z-index: 1000;
            display: flex; flex-direction: column; box-shadow: 4px 0 15px rgba(0,0,0,0.1);
            transition: transform var(--trans);
        }

        .sidebar-header { padding: 2.5rem 1.5rem 1.5rem; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
        
        .rc-logo {
            width: 90px; height: 90px; margin: 0 auto 1rem; border-radius: 50%;
            border: 3px solid var(--rc-white); overflow: hidden; background: var(--rc-white);
        }
        .rc-logo img { width: 100%; height: 100%; object-fit: cover; }
        
        .rc-title { font-size: 1.3rem; font-weight: 800; letter-spacing: 1px; color: var(--rc-white); }
        .rc-subtitle { font-size: 0.8rem; color: #94A3B8; text-transform: uppercase; letter-spacing: 2px; }

        .nav-menu { padding: 2rem 1rem; flex: 1; display: flex; flex-direction: column; gap: 8px; }
        
        .nav-link {
            width: 100%; padding: 16px 20px; border-radius: var(--radius-md); background: transparent;
            border: none; color: #CBD5E1; text-align: left; font-size: 1.05rem; font-weight: 500;
            cursor: pointer; transition: var(--trans); display: flex; align-items: center; gap: 15px;
        }
        .nav-link i { font-size: 1.2rem; width: 24px; text-align: center; }
        .nav-link:hover { background: rgba(255,255,255,0.05); color: var(--rc-white); transform: translateX(5px); }
        .nav-link.active { background: var(--rc-white); color: var(--rc-navy); font-weight: 700; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transform: translateX(5px); }

        .sidebar-footer { padding: 1.5rem; text-align: center; font-size: 0.8rem; color: rgba(255,255,255,0.5); border-top: 1px solid rgba(255,255,255,0.1); }

        /* ==========================================================================
           4. MAIN CONTENT & RESPONSIVE
           ========================================================================== */
        .main-wrapper { margin-left: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); min-height: 100vh; display: flex; flex-direction: column; transition: var(--trans); }
        
        .mobile-header {
            display: none; background: var(--rc-navy); padding: 15px 20px; color: var(--rc-white);
            align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 900;
        }
        .btn-menu { background: transparent; border: none; color: var(--rc-white); font-size: 1.5rem; cursor: pointer; }

        .content-container { padding: 3rem 2rem; max-width: 900px; margin: 0 auto; width: 100%; flex: 1; }
        
        .sidebar-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 999; display: none; opacity: 0; transition: opacity var(--trans); }

        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-wrapper { margin-left: 0; width: 100%; }
            .mobile-header { display: flex; }
            .sidebar-overlay.active { display: block; opacity: 1; }
            .content-container { padding: 2rem 1rem; }
        }

        /* ==========================================================================
           5. CARDS & THEORY STYLES
           ========================================================================== */
        .view-section { display: none; animation: fadeIn 0.5s ease forwards; opacity: 0; }
        .view-section.active { display: block; }
        @keyframes fadeIn { to { opacity: 1; } }

        .card { background: var(--rc-white); border-radius: var(--radius-lg); padding: 2.5rem; box-shadow: var(--shadow-sm); margin-bottom: 2rem; border: 1px solid var(--rc-gray); }
        
        .hero-title { font-size: 2.5rem; line-height: 1.2; margin-bottom: 1rem; color: var(--rc-navy); }
        .hero-divider { width: 60px; height: 5px; background: var(--rc-navy); border-radius: 5px; margin-bottom: 2rem; }

        .greeting-badge {
            display: inline-block; background: rgba(26, 43, 76, 0.05); color: var(--rc-navy);
            padding: 8px 16px; border-radius: 20px; font-weight: 700; font-size: 0.95rem; margin-bottom: 1.5rem;
            border: 1px solid var(--rc-gray);
        }

        .theory-box { background: var(--rc-bg); border-left: 5px solid var(--rc-navy); padding: 20px 25px; border-radius: 0 var(--radius-md) var(--radius-md) 0; margin-bottom: 20px; }
        .formula { font-family: monospace; font-size: 1.15rem; font-weight: 700; color: var(--rc-white); background: var(--rc-navy); padding: 10px 15px; border-radius: 8px; display: inline-block; margin: 10px 0; letter-spacing: 0.5px; }
        .example-en { font-weight: 700; color: var(--rc-navy); font-size: 1.1rem; margin-top: 10px; }
        .example-es { color: var(--text-muted); font-style: italic; font-size: 0.95rem; }

        .comparison-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 2rem; }
        .comp-card { background: var(--rc-white); border: 2px solid var(--rc-gray); border-radius: var(--radius-md); padding: 20px; text-align: center; }
        .comp-card h4 { font-family: 'Poppins'; color: var(--text-muted); text-transform: uppercase; font-size: 0.85rem; letter-spacing: 1px; margin-bottom: 15px; }
        
        @media (max-width: 768px) { .comparison-grid { grid-template-columns: 1fr; } }

        /* ==========================================================================
           6. AUDIO LAB STYLES
           ========================================================================== */
        .audio-item { display: flex; align-items: center; gap: 20px; padding: 15px 20px; border-bottom: 1px solid var(--rc-gray); transition: 0.2s; }
        .audio-item:hover { background: var(--rc-bg); border-radius: var(--radius-md); }
        .audio-item:last-child { border-bottom: none; }
        
        .btn-play {
            width: 50px; height: 50px; border-radius: 50%; border: none; background: var(--rc-navy);
            color: var(--rc-white); font-size: 1.2rem; cursor: pointer; display: flex; align-items: center; justify-content: center;
            box-shadow: var(--shadow-sm); transition: 0.2s; flex-shrink: 0;
        }
        .btn-play:active { transform: scale(0.9); }
        .btn-play.playing { animation: pulseNavy 1.5s infinite; background: var(--success); }
        @keyframes pulseNavy { 0% { box-shadow: 0 0 0 0 rgba(26,43,76,0.5); } 70% { box-shadow: 0 0 0 15px rgba(26,43,76,0); } 100% { box-shadow: 0 0 0 0 rgba(26,43,76,0); } }

        .type-badge { font-size: 0.75rem; font-weight: 800; padding: 3px 8px; border-radius: 4px; text-transform: uppercase; margin-left: 10px; vertical-align: middle; }
        .badge-wish { background: rgba(26,43,76,0.1); color: var(--rc-navy); }
        .badge-should { background: rgba(245,158,11,0.1); color: var(--warning); }

        /* ==========================================================================
           7. EXAM ENGINE STYLES
           ========================================================================== */
        .exam-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1rem; border-bottom: 2px solid var(--rc-gray); }
        .exam-stat { font-weight: 800; color: var(--rc-navy); font-size: 1.2rem; background: var(--rc-bg); padding: 5px 15px; border-radius: 20px; }
        
        .progress-track { flex: 1; height: 10px; background: var(--rc-gray); border-radius: 5px; margin: 0 20px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--rc-navy); width: 0%; transition: width 0.4s ease; }

        .q-display { display: none; animation: slideLeft 0.3s ease; }
        .q-display.active { display: block; }
        @keyframes slideLeft { from {opacity:0; transform:translateX(20px);} to {opacity:1; transform:translateX(0);} }

        .question-title { font-size: 1.4rem; font-weight: 600; color: var(--text-main); margin-bottom: 2rem; line-height: 1.5; }
        
        .mc-grid { display: grid; gap: 12px; margin-bottom: 2rem; }
        .mc-btn {
            width: 100%; padding: 18px 20px; border-radius: var(--radius-md); border: 2px solid var(--rc-gray);
            background: var(--rc-white); color: var(--text-main); font-size: 1.1rem; font-family: 'Poppins';
            text-align: left; cursor: pointer; font-weight: 500; transition: 0.2s;
        }
        .mc-btn:hover { border-color: var(--rc-navy); background: var(--rc-bg); }
        .mc-btn.selected { border-color: var(--rc-navy); background: var(--rc-navy); color: var(--rc-white); font-weight: 700; }
        .mc-btn.correct { border-color: var(--success); background: var(--success); color: white; }
        .mc-btn.wrong { border-color: var(--error); background: var(--error); color: white; }

        .type-input {
            width: 100%; padding: 20px; border-radius: var(--radius-md); border: 2px solid var(--rc-navy);
            font-size: 1.2rem; font-weight: 700; color: var(--rc-navy); text-align: center; font-family: 'Poppins';
            margin-bottom: 2rem; outline: none; transition: 0.3s;
        }
        .type-input.correct-ans { border-color: var(--success); color: var(--success); background: rgba(16,185,129,0.1); }
        .type-input.wrong-ans { border-color: var(--error); color: var(--error); background: rgba(239,68,68,0.1); }

        .btn-action {
            width: 100%; padding: 18px; border-radius: var(--radius-md); border: none;
            background: var(--rc-navy); color: var(--rc-white); font-size: 1.1rem; font-weight: 800;
            cursor: pointer; transition: 0.2s; box-shadow: var(--shadow-sm); letter-spacing: 1px;
        }
        .btn-action:disabled { background: var(--rc-gray); color: var(--text-muted); cursor: not-allowed; box-shadow: none; }
        .btn-action:hover:not(:disabled) { background: var(--rc-navy-light); transform: translateY(-2px); box-shadow: var(--shadow-lg); }

        /* ==========================================================================
           8. FOOTER & MODALS
           ========================================================================== */
        .rc-footer { background: var(--rc-navy); color: var(--rc-white); padding: 3rem 2rem; text-align: center; margin-top: auto; border-top: 5px solid rgba(255,255,255,0.1); }
        .footer-badge { display: inline-block; padding: 5px 12px; border: 1px solid rgba(255,255,255,0.3); border-radius: 6px; font-family: monospace; font-size: 0.8rem; margin-top: 15px; opacity: 0.8; }

        .modal-overlay { position: fixed; inset: 0; background: rgba(26,43,76,0.9); z-index: 5000; display: none; align-items: center; justify-content: center; padding: 20px; backdrop-filter: blur(5px); }
        .modal-box { background: var(--rc-white); width: 100%; max-width: 450px; padding: 3rem 2rem; border-radius: var(--radius-lg); text-align: center; animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .score-circle { width: 130px; height: 130px; border-radius: 50%; border: 8px solid var(--rc-navy); display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 2.8rem; font-weight: 800; color: var(--rc-navy); font-family: 'Poppins'; }
        
        #toast-container { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%); z-index: 9999; display: flex; flex-direction: column; gap: 10px; pointer-events: none; }
        .toast { background: var(--rc-navy); color: var(--rc-white); padding: 14px 24px; border-radius: 30px; font-weight: 500; font-size: 0.95rem; display: flex; align-items: center; gap: 10px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); animation: toastSlideUp 0.3s, fadeOut 0.3s 3s forwards; }
        @keyframes toastSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeOut { to { opacity: 0; transform: translateY(-20px); } }

    </style>
</head>
<body>

    <div id="welcome-gateway">
        <div class="gateway-logo">
            <img src="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w200" alt="Rators Club">
        </div>
        <h1 class="gateway-title">Rators Club Lab</h1>
        <p class="gateway-sub">Advanced Grammar Module</p>
        
        <input type="text" id="student-name-input" class="name-input" placeholder="Ingresa tu nombre..." autocomplete="off">
        <button class="btn-gateway" onclick="registerStudent()">INGRESAR AL LABORATORIO</button>
    </div>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="rc-logo">
                <img src="https://drive.google.com/thumbnail?id=1bOFY9XiVAv-WRQnVHXSnL5FHVEoK3UAp&sz=w200" alt="Rators Club Logo" onerror="this.src='https://via.placeholder.com/200x200.png?text=RC'">
            </div>
            <div class="rc-title">RATORS CLUB</div>
            <div class="rc-subtitle" id="sidebar-student-name">Student</div>
        </div>

        <nav class="nav-menu">
            <button class="nav-link active" onclick="navTo('home-theory', this)"><i class="fas fa-book-reader"></i> 1. Home & Theory</button>
            <button class="nav-link" onclick="navTo('audio-lab', this)"><i class="fas fa-headphones"></i> 2. Audio Lab</button>
            <button class="nav-link" onclick="navTo('final-test', this)"><i class="fas fa-laptop-code"></i> 3. Final Test</button>
        </nav>

        <div class="sidebar-footer">
            <button onclick="logout()" style="background:none; border:none; color:var(--error); cursor:pointer; font-family:'Poppins'; font-weight:600;"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</button>
        </div>
    </aside>

    <main class="main-wrapper" id="main-content" style="display:none;">
        
        <header class="mobile-header">
            <div style="font-weight:800; letter-spacing:1px;">RATORS CLUB</div>
            <button class="btn-menu" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
        </header>

        <div class="content-container">

            <section id="home-theory" class="view-section active">
                <div class="card" style="border-top: 8px solid var(--rc-navy);">
                    <div class="greeting-badge"><i class="fas fa-user-graduate"></i> Welcome back, <span id="welcome-greeting-name">Student</span></div>
                    <h1 class="hero-title">Past Regrets:<br>I wish I had...</h1>
                    <div class="hero-divider"></div>
                    
                    <p style="font-size: 1.1rem; color: var(--text-muted); margin-bottom: 2rem;">
                        En este módulo uniremos dos conceptos vitales: <strong>Should have</strong> (Crítica/Deber) y <strong>Wish + Past Perfect</strong> (Deseo/Lamento). Ambos hablan de un pasado que no podemos cambiar, pero la intención es distinta.
                    </p>

                    <h2 style="font-size:1.8rem; margin-top:2.5rem; margin-bottom:1rem;">The Grammar Formula</h2>
                    
                    <div class="theory-box">
                        <h3>Wishes in the Past (Lamentos)</h3>
                        <p style="margin-bottom:5px;">Usamos <strong>Wish + Past Perfect</strong> para expresar que nos gustaría que una situación pasada hubiera sido diferente.</p>
                        <div class="formula">Subject + wish + (that) + subject + had(n't) + V3</div>
                        <div style="margin-top:15px;">
                            <div class="example-en">I wish I had studied more.</div>
                            <div class="example-es">Desearía haber estudiado más. (Lamento personal).</div>
                        </div>
                    </div>

                    <div class="comparison-grid">
                        <div class="comp-card" style="border-color: var(--rc-navy);">
                            <h4>The Regret (Wish)</h4>
                            <p style="font-weight:600; color:var(--text-main); font-size:1.1rem;">"I wish I hadn't eaten so much."</p>
                            <p style="font-size:0.9rem; color:var(--text-muted);">Enfoque emocional. Deseas que la realidad pasada fuera distinta porque te sientes mal.</p>
                        </div>
                        <div class="comp-card" style="border-color: var(--warning);">
                            <h4>The Criticism (Should have)</h4>
                            <p style="font-weight:600; color:var(--text-main); font-size:1.1rem;">"I shouldn't have eaten so much."</p>
                            <p style="font-size:0.9rem; color:var(--text-muted);">Enfoque lógico. Reconoces que cometiste un error y criticas tu propia acción.</p>
                        </div>
                    </div>
                    
                    <div style="background: rgba(16,185,129,0.1); border-left: 4px solid var(--success); padding: 15px; border-radius: 8px; margin-top: 2rem;">
                        <strong><i class="fas fa-lightbulb" style="color:var(--success);"></i> Pro Tip:</strong> Ambos requieren forzosamente el Verbo en Pasado Participio (V3). ¡Nunca uses Pasado Simple aquí!
                    </div>
                </div>
            </section>

            <section id="audio-lab" class="view-section">
                <div class="card">
                    <h2 style="font-size:2rem; margin-bottom:1rem;">Audio Laboratory</h2>
                    <p style="color:var(--text-muted); margin-bottom:2rem;">Compara la pronunciación entre los lamentos con "Wish" y las críticas con "Should". Escucha con atención la contracción "had" ('d).</p>
                    
                    <div id="audio-container" style="display:flex; flex-direction:column; gap:5px;">
                        </div>
                </div>
            </section>

            <section id="final-test" class="view-section">
                <div class="card" id="test-welcome">
                    <div style="text-align:center; padding:2rem 0;">
                        <i class="fas fa-laptop-code" style="font-size:4rem; color:var(--rc-navy); margin-bottom:20px;"></i>
                        <h2 style="font-size:2.2rem; margin-bottom:15px;">Certification Test</h2>
                        <p style="max-width:500px; margin:0 auto 30px; font-size:1.1rem; color:var(--text-muted);">
                            Hola, <strong id="test-intro-name">Student</strong>. Este examen consta de <strong>15 reactivos</strong> que mezclan <em>Wish</em> y <em>Should have</em>. Tienes 3 intentos para lograr el 80%.
                        </p>
                        <button class="btn-action" style="max-width: 300px; margin:0 auto;" onclick="startQuiz()">
                            INICIAR EXAMEN <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>

                <div class="card" id="test-engine" style="display:none; padding:3rem;">
                    <div class="exam-header">
                        <div class="exam-stat" id="ui-progress">1 / 15</div>
                        <div class="progress-track"><div class="progress-fill" id="ui-bar"></div></div>
                        <div class="exam-stat" style="color:var(--text-muted); background:none;" id="ui-score">0 pts</div>
                    </div>
                    
                    <div style="text-align:right; margin-bottom:1rem; color:var(--error); font-weight:700; font-size:0.9rem;" id="lives-display">
                        <i class="fas fa-heart"></i> <i class="fas fa-heart"></i> <i class="fas fa-heart"></i>
                    </div>

                    <div id="quiz-area" style="min-height:220px;">
                        </div>

                    <button class="btn-action" id="btn-submit" onclick="submitQuestion()" disabled>CHECK ANSWER</button>
                </div>
            </section>

        </div> <footer class="rc-footer">
            <h3 style="color:white; font-family:'Poppins'; margin-bottom:10px;">RATORS CLUB</h3>
            <p style="font-size:0.9rem; opacity:0.8; max-width:600px; margin:0 auto 20px;">
                Designed & Engineered for exclusive grammar mastery by Teacher Netza.
            </p>
            <div style="margin-bottom:20px;">
                <i class="fab fa-html5" style="font-size:1.5rem; margin:0 10px;"></i>
                <i class="fab fa-css3-alt" style="font-size:1.5rem; margin:0 10px;"></i>
                <i class="fab fa-js" style="font-size:1.5rem; margin:0 10px;"></i>
            </div>
            <p style="font-size:0.8rem; opacity:0.6; margin:0;">
                &copy; 2026 Netza Creation. All rights reserved.
            </p>
            <div class="footer-badge">GNU General Public License v3.0</div>
        </footer>

    </main>

    <div id="toast-container"></div>

    <div class="modal-overlay" id="resultModal">
        <div class="modal-box">
            <h2 style="font-size:2rem; margin-bottom:10px; font-family:'Lora';" id="modalTitle">Test Complete</h2>
            <p style="font-size:1.1rem; font-weight:600; color:var(--rc-navy); margin-bottom:20px;" id="modalStudentName">Student Name</p>
            
            <div class="score-circle" id="modalScore">100%</div>
            <p id="modalMsg" style="font-size:1rem; color:var(--text-muted); margin-bottom:30px;">Mensaje de evaluación</p>
            <button class="btn-action" onclick="location.reload()"><i class="fas fa-check"></i> CONTINUAR</button>
        </div>
    </div>

    <script>
        // --- 0. SISTEMA DE LOGIN Y MEMORIA ---
        let studentName = "";

        function checkLogin() {
            const savedName = localStorage.getItem('rc_student_name');
            if(savedName) {
                studentName = savedName;
                document.getElementById('welcome-gateway').style.display = 'none';
                document.getElementById('main-content').style.display = 'flex';
                updateNameUI();
            }
        }

        function registerStudent() {
            const val = document.getElementById('student-name-input').value.trim();
            if(val.length < 2) {
                showToast("Por favor, ingresa tu nombre real.", true);
                return;
            }
            studentName = val;
            localStorage.setItem('rc_student_name', studentName);
            
            document.getElementById('welcome-gateway').style.animation = "fadeIn 0.4s reverse forwards";
            setTimeout(() => {
                document.getElementById('welcome-gateway').style.display = 'none';
                document.getElementById('main-content').style.display = 'flex';
                updateNameUI();
                showToast(`¡Bienvenido al Rators Club, ${studentName}!`);
            }, 400);
        }

        function updateNameUI() {
            document.getElementById('sidebar-student-name').innerText = studentName;
            document.getElementById('welcome-greeting-name').innerText = studentName;
            document.getElementById('test-intro-name').innerText = studentName;
        }

        function logout() {
            localStorage.removeItem('rc_student_name');
            localStorage.removeItem('rc_quiz_attempts');
            location.reload();
        }

        // --- 1. DATOS DE AUDIO (15 Oraciones Mixtas) ---
        const audioDB = [
            { type: 'wish', en: "I wish I had brought my umbrella.", es: "Desearía haber traído mi paraguas." },
            { type: 'should', en: "I should have checked the weather.", es: "Debí haber revisado el clima." },
            { type: 'wish', en: "She wishes she hadn't said that.", es: "Ella desearía no haber dicho eso." },
            { type: 'should', en: "She shouldn't have insulted him.", es: "Ella no debió haberlo insultado." },
            { type: 'wish', en: "We wish we had stayed longer.", es: "Desearíamos habernos quedado más tiempo." },
            { type: 'wish', en: "I wish I had known about the party.", es: "Desearía haber sabido sobre la fiesta." },
            { type: 'should', en: "You should have told me earlier.", es: "Debiste haberme dicho antes." },
            { type: 'wish', en: "He wishes he had studied engineering.", es: "Él desearía haber estudiado ingeniería." },
            { type: 'wish', en: "I wish I hadn't eaten so much cake.", es: "Desearía no haber comido tanto pastel." },
            { type: 'should', en: "I shouldn't have eaten so much cake.", es: "No debí haber comido tanto pastel." },
            { type: 'wish', en: "They wish they had saved more money.", es: "Ellos desearían haber ahorrado más dinero." },
            { type: 'should', en: "They shouldn't have bought that expensive car.", es: "No debieron haber comprado ese auto caro." },
            { type: 'wish', en: "I wish I had taken your advice.", es: "Desearía haber tomado tu consejo." },
            { type: 'should', en: "You should have listened to me.", es: "Debiste haberme escuchado." },
            { type: 'wish', en: "I wish I hadn't lost my phone.", es: "Desearía no haber perdido mi teléfono." }
        ];

        // --- 2. DATOS DEL EXAMEN (15 Reactivos: 10 MC, 5 Typing) ---
        const quizDB = [
            // Multiple Choice
            { type: "mc", q: "I'm completely soaked. I wish I _____ my umbrella.", opts: ["had brought", "should have brought", "brought"], ans: 0 },
            { type: "mc", q: "She failed the exam. She wishes she _____ harder.", opts: ["studied", "should have studied", "had studied"], ans: 2 },
            { type: "mc", q: "I feel sick. I shouldn't have eaten so much. = I wish I _____ eaten so much.", opts: ["hadn't", "shouldn't", "didn't"], ans: 0 },
            { type: "mc", q: "We are lost. We _____ brought the GPS.", opts: ["wish we had", "should have", "had"], ans: 1 },
            { type: "mc", q: "He wishes he _____ (not/buy) that old car, it's always broken.", opts: ["shouldn't have bought", "didn't buy", "hadn't bought"], ans: 2 },
            { type: "mc", q: "My phone is dead. I _____ charged it last night.", opts: ["should charge", "should have", "wish I had"], ans: 1 },
            { type: "mc", q: "I have no money. I wish I _____ saved more.", opts: ["had", "should have", "have"], ans: 0 },
            { type: "mc", q: "You got a ticket! You _____ parked there.", opts: ["should have", "shouldn't have", "wish you hadn't"], ans: 1 },
            { type: "mc", q: "They didn't understand the movie. They wish they _____ read the book first.", opts: ["had", "should have", "have"], ans: 0 },
            { type: "mc", q: "The hotel was terrible. We _____ stayed there.", opts: ["should have", "shouldn't have", "wish we had"], ans: 1 },
            // Typing (Focus on Past Participles & Auxiliary)
            { type: "type", q: "I didn't do my homework. I wish I _____ (do) it.", ans: ["had done"] },
            { type: "type", q: "She bought an ugly dress. She wishes she _____ (not/buy) it.", ans: ["hadn't bought", "had not bought"] },
            { type: "type", q: "We didn't go to the doctor. We should _____ (go).", ans: ["have gone"] },
            { type: "type", q: "You drank my milk! You shouldn't _____ (drink) it.", ans: ["have drunk"] },
            { type: "type", q: "I didn't speak to the manager. I wish I _____ (speak) to him.", ans: ["had spoken"] }
        ];

        // --- 3. ESTADOS GLOBALES ---
        let quizState = { active: false, index: 0, score: 0, selectedOpt: null, answered: false };
        let attemptsLeft = 3;

        // --- 4. MOTOR TTS (AUDIO) ---
        const synth = window.speechSynthesis;
        let engVoice = null;

        function initVoices() {
            const voices = synth.getVoices();
            engVoice = voices.find(v => v.lang.includes('en-US') && v.name.includes('Google')) || voices.find(v => v.lang.includes('en-US'));
        }
        if (speechSynthesis.onvoiceschanged !== undefined) { speechSynthesis.onvoiceschanged = initVoices; }

        function playSound(text, btnElement) {
            if (synth.speaking) synth.cancel();
            const u = new SpeechSynthesisUtterance(text);
            if (engVoice) u.voice = engVoice;
            u.lang = 'en-US'; u.rate = 0.85; 
            
            u.onstart = () => {
                document.querySelectorAll('.btn-play').forEach(b => b.classList.remove('playing'));
                btnElement.classList.add('playing');
            };
            u.onend = () => btnElement.classList.remove('playing');
            synth.speak(u);
        }

        // Renderizar Audios
        function renderAudios() {
            const container = document.getElementById('audio-container');
            let html = '';
            audioDB.forEach((item) => {
                let badge = item.type === 'wish' ? `<span class="type-badge badge-wish">WISH</span>` : `<span class="type-badge badge-should">SHOULD</span>`;
                html += `
                <div class="audio-item">
                    <button class="btn-play" onclick="playSound('${item.en.replace(/'/g, "\\'")}', this)"><i class="fas fa-play"></i></button>
                    <div>
                        <div style="font-size:1.1rem; font-weight:700; color:var(--rc-navy); font-family:'Lora';">${item.en} ${badge}</div>
                        <div style="font-size:0.9rem; color:var(--text-muted); font-style:italic;">${item.es}</div>
                    </div>
                </div>`;
            });
            container.innerHTML = html;
        }

        // --- 5. LÓGICA DE INTERFAZ (SIDEBAR & TABS) ---
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('active');
        }

        function navTo(tabId, btnElement) {
            document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
            btnElement.classList.add('active');

            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');

            if(window.innerWidth <= 992) toggleSidebar();
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function showToast(msg, isError = false) {
            const box = document.getElementById('toast-container');
            const t = document.createElement('div');
            t.className = 'toast';
            if(isError) { t.style.background = 'var(--error)'; }
            t.innerHTML = `<i class="fas fa-${isError?'times':'check'}-circle"></i> <span>${msg}</span>`;
            box.appendChild(t);
            setTimeout(() => t.remove(), 3500);
        }

        // --- 6. MOTOR DEL EXAMEN (15 Preguntas) ---
        function startQuiz() {
            // Check attempts memory
            const memAttempts = localStorage.getItem('rc_quiz_attempts');
            attemptsLeft = memAttempts ? parseInt(memAttempts) : 3;

            if(attemptsLeft <= 0) {
                showToast("Ya no te quedan intentos. Reiniciando contador de sistema...", true);
                attemptsLeft = 3; // Reset para demo
            }

            document.getElementById('test-welcome').style.display = 'none';
            document.getElementById('test-engine').style.display = 'block';
            quizState = { active: true, index: 0, score: 0, selectedOpt: null, answered: false };
            updateLivesUI();
            renderQuestion();
        }

        function updateLivesUI() {
            const display = document.getElementById('lives-display');
            let hearts = "";
            for(let i=0; i<3; i++) {
                if(i < attemptsLeft) hearts += `<i class="fas fa-heart"></i> `;
                else hearts += `<i class="far fa-heart" style="color:var(--rc-gray);"></i> `;
            }
            display.innerHTML = hearts;
        }

        function renderQuestion() {
            const q = quizDB[quizState.index];
            const area = document.getElementById('quiz-area');
            const btn = document.getElementById('btn-submit');
            
            quizState.answered = false;
            quizState.selectedOpt = null;
            btn.innerText = "CHECK ANSWER";
            btn.disabled = true;

            // UI Progress
            document.getElementById('ui-progress').innerText = `${quizState.index + 1} / ${quizDB.length}`;
            document.getElementById('ui-score').innerText = `${quizState.score} pts`;
            document.getElementById('ui-bar').style.width = `${((quizState.index) / quizDB.length) * 100}%`;

            let html = `<div class="q-display active"><div class="question-title">${quizState.index + 1}. ${q.q}</div>`;

            if (q.type === 'mc') {
                html += `<div class="mc-grid">`;
                q.opts.forEach((opt, i) => {
                    html += `<button class="mc-btn" onclick="selectMC(${i}, this)">${opt}</button>`;
                });
                html += `</div>`;
            } else {
                html += `<input type="text" id="type-ans" class="type-input" placeholder="Type answer here..." autocomplete="off" spellcheck="false" oninput="checkTypeInput()">`;
            }
            html += `</div>`;
            area.innerHTML = html;
        }

        function selectMC(idx, btnElement) {
            if(quizState.answered) return;
            document.querySelectorAll('.mc-btn').forEach(b => b.classList.remove('selected'));
            btnElement.classList.add('selected');
            quizState.selectedOpt = idx;
            document.getElementById('btn-submit').disabled = false;
        }

        function checkTypeInput() {
            if(quizState.answered) return;
            const val = document.getElementById('type-ans').value.trim();
            document.getElementById('btn-submit').disabled = val.length === 0;
        }

        function submitQuestion() {
            const q = quizDB[quizState.index];
            const btn = document.getElementById('btn-submit');

            if (!quizState.answered) {
                // FASE 1: EVALUAR
                quizState.answered = true;
                let isCorrect = false;

                if (q.type === 'mc') {
                    const btns = document.querySelectorAll('.mc-btn');
                    if (quizState.selectedOpt === q.ans) {
                        isCorrect = true;
                        btns[quizState.selectedOpt].classList.add('correct');
                    } else {
                        btns[quizState.selectedOpt].classList.add('wrong');
                        btns[q.ans].classList.add('correct');
                    }
                } else {
                    const input = document.getElementById('type-ans');
                    // Limpieza de texto ingresado
                    const userVal = input.value.trim().toLowerCase().replace(/‘|’|´/g, "'").replace(/[.,]/g, "");
                    input.readOnly = true;
                    if (q.ans.includes(userVal)) {
                        isCorrect = true;
                        input.classList.add('correct-ans');
                    } else {
                        input.classList.add('wrong-ans');
                        input.value = `${input.value} ❌ (Ans: ${q.ans[0]})`;
                    }
                }

                if (isCorrect) quizState.score++;
                
                btn.innerText = (quizState.index === quizDB.length - 1) ? "FINISH EXAM" : "NEXT QUESTION";

            } else {
                // FASE 2: AVANZAR
                quizState.index++;
                if (quizState.index < quizDB.length) {
                    renderQuestion();
                } else {
                    finishQuiz();
                }
            }
        }

        function finishQuiz() {
            document.getElementById('ui-bar').style.width = '100%';
            const pct = Math.round((quizState.score / quizDB.length) * 100);
            
            const modal = document.getElementById('resultModal');
            const circle = document.getElementById('modalScore');
            const msg = document.getElementById('modalMsg');
            
            document.getElementById('modalStudentName').innerText = studentName.toUpperCase();
            circle.innerText = `${pct}%`;

            if (pct >= 80) {
                circle.style.borderColor = "var(--success)";
                circle.style.color = "var(--success)";
                msg.innerText = `¡Certificación aprobada, ${studentName}! Eres oficialmente un experto en los lamentos del pasado.`;
                confetti({ particleCount: 200, spread: 90, origin: { y: 0.5 } });
                attemptsLeft = 3; // Reset wins
            } else {
                attemptsLeft--;
                localStorage.setItem('rc_quiz_attempts', attemptsLeft.toString());
                circle.style.borderColor = "var(--error)";
                circle.style.color = "var(--error)";
                
                if(attemptsLeft > 0) {
                    msg.innerText = `Obtuviste ${quizState.score} de ${quizDB.length}. Te quedan ${attemptsLeft} intento(s) para lograr el 80%.`;
                } else {
                    msg.innerText = `Has agotado tus intentos. El sistema reiniciará tus oportunidades, pero debes repasar la teoría.`;
                    localStorage.setItem('rc_quiz_attempts', '3'); // reset for next time
                }
            }

            modal.style.display = 'flex';
        }

        // --- 7. ARRANQUE DE LA APP ---
        window.onload = () => {
            checkLogin();
            initVoices();
            renderAudios();
        };

    </script>
</body>
</html>
